sudo: required

language: cpp
services:
  - docker

script:
  - chmod +x deploy/build.sh
  - docker build . -t wine.appimage
  - sudo cp "$(sudo find /var/lib/docker -name 'Wine-*x86_64.AppImage')" .
  - sudo chmod 777 Wine-*x86_64.AppImage

after_success:
  - mkdir out
  - docker run --rm -v $(pwd)/out:/tmp/out -ti wine.appimage cp Wine-x86_64.AppImage /tmp/Wine-x86_64.AppImage
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - curl --upload-file ./Wine.AppImage "https://transfer.sh"/Wine-*x86_64.AppImage
  - bash upload.sh Wine-*x86_64.AppImage

branches:
  except:
    - # Do not build tags that we create when we upload to GitHub Releases
    - /^(?i:continuous)/

